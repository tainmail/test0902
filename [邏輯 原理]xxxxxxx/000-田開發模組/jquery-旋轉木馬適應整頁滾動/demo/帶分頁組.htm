<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>jquery-旋轉木馬適應整頁滾動</title>
<script type="text/javascript" src="jquery.js"></script>
<style>

</style>

<style>
*{ margin:0px; padding:0px;}
a img { border: none; }

ol li{ float:left; margin-right:20px;}


/*slidePage 設定======================================*/
body{ overflow-x:hidden;/*必要*/} 
/*圖集*/
.gallery_1 {width:1000px; margin:0 auto; height:500px; position: relative;}
/*外容器*/
.gallery_1 .run {width:1000px; margin:0 auto; height:500px; position:relative;}
/*內容器*/
.gallery_1 .run .runinner {/*width:由程式定義*/ height:500px; float:left; position:relative;}
/*單組*/
.gallery_1 .run .runinner .piece {width:1000px; height:500px; position:relative; float:left; }

/*上下頁按鈕*/
.gallery_1 a.prev { display:block; width:100%; height:500px; background:url(btn_prev.jpg) no-repeat right top; position:absolute; top:0px; right:1000px; opacity:0.7;  }
.gallery_1 a.next { display:block; width:100%; height:500px; background:url(btn_next.jpg) no-repeat left top;  position:absolute; top:0px; left:1000px;  opacity:0.7;  }
.gallery_1 a.prev span, .gallery_1 a.next span{ display:none;}

.gallery_1 .pager{ background:red; width:200px; height:50px; position:absolute; right:20px; top:20px; z-index:1000;}
.gallery_1 .pager a { display:block; width:20px; height:20px; float:left; background:#ccc; margin-right:10px;}
.gallery_1 .pager a.current{ border:5px solid yellow;}


</style>

<script type="text/javascript">
$(function(){
	var $slidePage = $('.gallery_1'),               //圖集組 
	$run = $slidePage.find('.run'),                 //外容器
	$runInner = $run.find('.runinner'),             //內容器
	$piece = $runInner.find(".piece"),              //圖集組
	
	iRunWidth = $run.width(),                       //圖集的寬
	iPieceAmount = $piece.length,                   //圖集組數
	iRunInnerWidth = ($run.width()) * iPieceAmount, //內容器總寬 
	iRunLeft = iRunWidth * -1,                      //向左移的距離 
	iRunSpeed = 400,                                //左移的速度
	iTimer,               // 加入計時器
	iShowDuration = 2000, //輪播時間及
	bStop = false         //控制開關
	
	//初始化-新增分頁結構
	var sPager = "";
	for (i=0; i<iPieceAmount; i++){
		 sPager += "<a href=\"javascript:void(0)\">"+ (i+1) +"</a>";
	}
	$(".pager").append(sPager);
	
	//初始化-加標籤rel序
	for (i=0; i<=iPieceAmount; i++){
		$(".piece").eq(i).attr("rel",i)
	}

	//初始化
	$runInner.width(iRunInnerWidth)
		.find('.piece:first')
		.before($runInner.find('.piece:last')) // 先把最後一個 .piece 的內容插入到第一個 .piece 前面
		.end()
		.css({
			left: iRunLeft
		}
	);
	
	fnPagerCurrent();//當前頁數高亮
	
	// 當點擊到 a.prev 時
	var $prev = $slidePage.find('a.prev')
				.click(function(){
					// 移動 $runInner
					$runInner.stop(false, true).animate({'left' : iRunLeft + iRunWidth}, iRunSpeed, function () {
						// 把最後一個 .piece 的內容插入到第一個 .piece 前面
						$runInner.find('.piece:first').before($runInner.find('.piece:last')).end().css('left', iRunLeft);
						fnPagerCurrent();//當前頁數高亮
						// 當移動到正確位置後, 依判斷來啟動計時器
						if(!bStop) {
							clearTimeout(iTimer);
							iTimer = setTimeout(fnMove, iShowDuration);
						}
					});
					return false;
				});

	// 當點擊到 a.next 時
	var $next = $slidePage.find('a.next')
				.click(function(){
					// 移動 $runInner
					$runInner.stop(false, true).animate({'left' : iRunLeft - iRunWidth}, iRunSpeed, function () {
						// 把第一個 .piece 的內容插入到最後一個 .piece 後面
						$runInner.find('.piece:last').after($runInner.find('.piece:first')).end().css('left', iRunLeft);
						fnPagerCurrent();//當前頁數高亮
						// 當移動到正確位置後, 依判斷來啟動計時器
						if(!bStop) {
							clearTimeout(iTimer);
							iTimer = setTimeout(fnMove, iShowDuration);
						}
					});
					return false;
				});

	// 如果滑鼠移入 $slidePage 時
	$slidePage.hover(
		function(){
			bStop = true;// 關閉開關及計時器
			clearTimeout(iTimer);
		}, 
		function(){
			bStop = false; // 開啟開關及計時器
			iTimer = setTimeout(fnMove, iShowDuration);
		})
		.find('a').focus(function(){
			this.blur();
		});

	// 計時器使用
	function fnMove(){
		$next.click();
	};
	
	iTimer = setTimeout(fnMove, iShowDuration);
	
	//當前頁數高亮
	function fnPagerCurrent(){
		var iCurrent  = $(".piece").eq(1).attr("rel"); //當前顯示的頁數
		$(".pager a").removeClass("current");
		$(".pager a").eq(iCurrent).addClass("current");
	};
	
	//點擊分頁
	$(".pager a").click(function(){
		var iNo = $(".pager a").index(this); //分頁序
		var iCurrent  = $(".piece").eq(1).attr("rel"); //當前顯示的頁數
		var iGo = iCurrent-iNo //要點幾次
		if(iGo < 0){
			iGo=Math.abs(iGo)
			for (i=1; i<=iGo; i++){
				$next.click();
			}
		}else if(iGo > 0){
			for (i=1; i<=iGo; i++){
				$prev.click();
			}
		}else{
			//在當前頁
		}
	});

});

</script> 

</head>
<body>
<div class="header" style=" width:1000px; margin:0 auto; height:100px; background:#777;"><h1>jquery-旋轉木馬適應整頁滾動</h1></div>

<!--圖集 開始-->
<div class="gallery_1">
    <!--分頁組 開始-->
    <div class="pager"><!--插入頁碼--></div>
    <!--分頁組 結束-->
    
    <!--滾動組 開始-->
    <div class="run">
        <div class="runinner">
            <div class="piece"><a href="#"><img src="pic/pic001.jpg"/></a></div>
            <div class="piece"><a href="#"><img src="pic/pic002.jpg"/></a></div>
            <div class="piece"><a href="#"><img src="pic/pic003.jpg"/></a></div>
            <div class="piece"><a href="#"><img src="pic/pic004.jpg"/></a></div>
            <div class="piece"><div class="box_1" style=" width:300px; height:200px; background:#99CC33;">這是非圖像內容</div></div>
            <div class="piece"><a href="#"><img src="pic/pic005.jpg"/></a></div>
        </div>
    </div>
    <!--滾動組 結束-->
    
    <!--上下頁組 開始-->
    <a href="#" class="prev"><span>上一頁</span></a>
    <a href="#" class="next"><span>下一頁</span></a>
    <!--上下頁組 結束-->
</div>
<!--圖集 開始-->
    
<div class="footer" style=" width:1000px; margin:0 auto; height:100px; background:#333;"><h1>footer</h1></div>

</body>
</html>
