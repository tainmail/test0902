<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>滾到 高亮 邏輯</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
<style>
* { margin: 0px; padding: 0px; font-family: "微軟正黑體"; }
* { -webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; }
html,
body { height: 100%; }
ul { list-style: none; }
/*清除 clearfix*/
.clearfix:after { content: "."; display: block; height: 0; clear: both; visibility: hidden; }
.clearfix {
*zoom: 1; _zoom: 1; }
/*控制pre*/
pre { border: 2px solid pink; padding: 5px; font-size: 12px; background: #fff; clear: both; font-size: 12px; font-family: Verdana; }
pre strong { color: #CC0000; }
pre em { font-style: normal; font-weight: bold; color: #006600; }

/*header*/
.header{ border:5px dashed green; min-height:200px;}

/*footer*/
.footer{ border:5px dashed green; min-height:200px;}



/*選單*/
.nav { width: 60px; position: fixed; right: 0; top: 0; bottom: 0; margin: auto; z-index: 88; }
.nav li { width: 60px; height: 50px; }
.nav li a { display: block; width: 60px; height: 50px; background: #CCC; }
.nav li a:hover { background: #777; }
.nav li a.active { background: gold; }


/*容器*/
.wrapper { }
.wrapper .piece { min-height: 800px; border: 5px dashed purple; overflow: hidden; }
.wrapper .piece span { font-size: 300px; }


</style>
<script type="text/javascript" src="jquery.js"></script>

<script>

$(function(){
	
	
	var iWinScrollTop;
	
	//計算 每個容器的位置點
	function fnRecInfo(){
		$('.nav a').each(function(i) {
			var $this = $('.nav a').eq(i);
			var sIdName = $this.attr("href");  //取得 href 的 id 字串
			var $Piece = $(sIdName); //容器名稱
			var iPieceH= $Piece.outerHeight(true); //容器高
			var iPieceOffsetTop = Math.ceil($Piece.offset().top); //容器起點
			var iPieceOffsetBottom = iPieceOffsetTop + iPieceH; //容器終點
			
		   //用.data()記錄 每個容器的頭尾點
		   $this.data("top", iPieceOffsetTop);
		   $this.data("bottom", iPieceOffsetBottom);
		   
		});
	};
	
	
	//增加高亮
	function fnAddActive(){
		iWinScrollTop = $(window).scrollTop();
		$('.active').removeClass('active');
		
		$('.nav a').each(function(i){
			var $this = $('.nav a').eq(i);
			//取.data()記錄 比對是否 in view
			if(iWinScrollTop >= $this.data("top") && iWinScrollTop < $this.data("bottom")){ 
				$this.addClass('active');
				return;
			};
		});
	};
	
	//初始執行
	fnRecInfo();
	
	
	//視窗改變 執行計算位置
	$(window).on("resize", fnRecInfo);
	
	//視窗改變 滾動執行高亮
	$(window).on("scroll resize", fnAddActive);
	
	
	//點擊 滾動到目標
	$('.nav a').click(function(){
		var $this = $(this);
		var sIdName = $(this).attr('href')
		$('.active').removeClass('active');
		$this.addClass('active');
	
		$('html, body').stop().animate({
			scrollTop: parseInt($(sIdName).offset().top)
		});
		return false;
	});
	
		
});





</script>
</head>
<body>
<div class="header"><h1>滾到 高亮 邏輯</h1>
<p>本例：目標頂端觸及視窗頂端<br>
    用陣列物件記錄 每個容器的位置點<br>
判斷 in view 在可視範圍</p>
</div>

<!--選單 開始-->
<div class="nav">
    <ul>
        <li><a href="#piece000">000</a></li>
        <li><a href="#piece111">111</a></li>
        <li><a href="#piece222">222</a></li>
        <li><a href="#piece333">333</a></li>
    </ul>
</div>
<!--選單 結束--> 

<!--wrapper 開始-->
<div class="wrapper">
 
    <!--piece 開始-->
    <div class="piece" id="piece000"> <span>000</span> </div>
    <!--piece 結束-->
    
    <!--piece 開始-->
    <div class="piece" id="piece111"> <span> 111 111 111 111 111 111 111 111 111 111 111 111 111 111 111 111</span> </div>
    <!--piece 結束-->
    
    <!--piece 開始-->
    <div class="piece" id="piece222"> <span>222</span> </div>
    <!--piece 結束-->
    
    <!--piece 開始-->
    <div class="piece" id="piece333"> <span>333</span> </div>
    <!--piece 結束-->
    
</div>
<!--wrapper 結束-->


<div class="footer">撐高用</div>

</body>
</html>
